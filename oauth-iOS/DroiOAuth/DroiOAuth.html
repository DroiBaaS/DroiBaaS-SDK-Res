<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>第三方授权</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="xo1t" id="第三方授权">第三方授权</h1><div class="md-section-divider"></div><h2 data-anchor-id="w2ic" id="简介">简介</h2><p data-anchor-id="9d8v">卓易第三方登录(DroiOAuth) SDK是依托卓易市场、FreeMeOS庞大用户群体和海量优势资源，使得广大合作伙伴和第三方开发者接入卓易帐号功能后能够轻松享有卓易产品中的海量用户资源。用户可以方便快捷地使用卓易帐号登录开发者网站或者移动应用，同时为用户带来统一、友好的登录体验。</p><div class="md-section-divider"></div><h2 data-anchor-id="m7o1" id="安装">安装</h2><div class="md-section-divider"></div><h3 data-anchor-id="uui4" id="开发环境">开发环境</h3><ul data-anchor-id="vphf">
<li>操作系统：Mac OS X等</li>
<li>开发工具：Xcode 6.x 及以上版本</li>
<li>iOS版本：需要iOS 8.0及以上系统  </li>
</ul><div class="md-section-divider"></div><h3 data-anchor-id="liv2" id="使用cocoapods方式集成推荐">使用CocoaPods方式集成（推荐）</h3><p data-anchor-id="pv1x">DroiOAuth SDK使用CocoaPods作为函数库的管理工具。我们推荐您使用CocoaPods这种方式来安装SDK，这样可以大大简化安装DroiOAuth SDK的流程。如果您未安装CocoaPods，请参考《CocoaPods安装和使用教程》完成安装。CocoaPods安装完成后，在您的项目根目录下创建一个Podfile文件，并添加如下内容：</p><pre data-anchor-id="p3pf"><code>pod  'DroiOAuth'
</code></pre><p data-anchor-id="ge17">在控制台中cd到Podfile文件所在目录，执行如下命令完成安装。</p><pre data-anchor-id="og5t"><code>pod  install
</code></pre><div class="md-section-divider"></div><h3 data-anchor-id="81oc" id="手动集成">手动集成</h3><div class="md-section-divider"></div><h4 data-anchor-id="vmi1" id="1-安装droicore-sdk">1. 安装DroiCore SDK</h4><p data-anchor-id="c1f3">由于DroiOAuth SDK依赖于DroiCore SDK，所以请在安装DroiOAuth SDK之前仔细阅读<a href="http://baastest.droi.cn/Index/docStart.html" target="_blank">快速入门</a> ，完成DroiCore SDK的安装。</p><div class="md-section-divider"></div><h4 data-anchor-id="2u3u" id="2-导入sdk到应用程序项目">2. 导入SDK到应用程序项目</h4><p data-anchor-id="y1i9">将SDK包解压，在XCode中选择”Add files to 'Your project name’…”，将解压后的DroiOAuthLib文件夹中的<code>DroiOAuth.framework</code>添加到你的工程目录中。。</p><div class="md-section-divider"></div><h4 data-anchor-id="t78a" id="3-添加必要的框架">3. 添加必要的框架</h4><p data-anchor-id="aml6">点击Build Phases选项，在Link Binary With Libraries中添加以下内容：</p><ul data-anchor-id="nyg2">
<li>Foundation.framework</li>
<li>UIKit.framework</li>
<li>JavaScriptCore.framework</li>
</ul><div class="md-section-divider"></div><h4 data-anchor-id="di8x" id="4-将droioauthframework加入到copy-bundle-resources中">4. 将DroiOAuth.framework加入到Copy Bundle Resources中</h4><p data-anchor-id="pig8">点击Build Phases选项，在Copy Bundle Resources中添加DroiOAuth.framework，如图所示：</p><p data-anchor-id="rr1f"><img src="http://baastest.droi.cn/Uploads/DocFile/57692b2a0f2b6.png" alt="此处输入图片的描述" title=""></p><div class="md-section-divider"></div><h2 data-anchor-id="tmj6" id="使用">使用</h2><div class="md-section-divider"></div><h3 data-anchor-id="zfa1" id="登录授权获取token">登录授权获取token</h3><p data-anchor-id="7i8d">在适合的页面调用登录接口后，会自动跳转到登录页面，登录完成后会在callback回调用户的token信息，开发者可以使用token获取相应的用户信息</p><p data-anchor-id="7jli">示例：在当前页面中调用登录接口获取token</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="h315"><ol class="linenums"><li class="L0"><code><span class="pun">[</span><span class="typ">DroiOAuth</span><span class="pln"> loginWithViewController</span><span class="pun">:</span><span class="kwd">self</span><span class="pln"> </span><span class="typ">Callback</span><span class="pun">:^(</span><span class="pln">id </span><span class="kwd">object</span><span class="pun">,</span><span class="pln"> </span><span class="typ">NSError</span><span class="pln"> </span><span class="pun">*</span><span class="pln">error</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">error </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">nil</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">        </span><span class="typ">NSDictionary</span><span class="pln"> </span><span class="pun">*</span><span class="pln">token </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">        </span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"token:%@"</span><span class="pun">,</span><span class="pln">token</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">        </span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"error:%@"</span><span class="pun">,</span><span class="pln">error</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pun">}];</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="4fyw" id="获取用户相关信息">获取用户相关信息</h3><p data-anchor-id="ojdm">如果token正确，填入不同的scope可以获取到用户的不同信息，scope可以有以下三种：</p><ul data-anchor-id="wicb">
<li>DroiOAuthScopeUserInfo：用户基础信息，包括用户昵称，性别等</li>
<li>DroiOAuthScopeUserPhoneNumber：用户手机号信息</li>
<li>DroiOAuthScopeUserEmail：用户邮箱信息</li>
</ul><p data-anchor-id="o01n">示例：根据调用登录接口获取到的tokenData数据获取用户基础信息、用户手机信息和用户邮箱信息</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="iqd2"><ol class="linenums"><li class="L0"><code><span class="typ">DroiOAuthScope</span><span class="pln"> scope </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DroiOAuthScopeUserInfo</span><span class="pun">|</span><span class="typ">DroiOAuthScopeUserPhoneNumber</span><span class="pun">|</span><span class="typ">DroiOAuthScopeUserEmail</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pun">[</span><span class="typ">DroiOAuth</span><span class="pln"> getUserInfoWithToken</span><span class="pun">:</span><span class="pln">token </span><span class="typ">Scope</span><span class="pun">:</span><span class="pln">scope </span><span class="typ">Callback</span><span class="pun">:^(</span><span class="pln">id </span><span class="kwd">object</span><span class="pun">,</span><span class="pln"> </span><span class="typ">NSError</span><span class="pln"> </span><span class="pun">*</span><span class="pln">error</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">error </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">nil</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">        </span></code></li><li class="L3"><code><span class="pln">        </span><span class="typ">NSDictionary</span><span class="pln"> </span><span class="pun">*</span><span class="pln">userInfo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">        </span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"userInfo:%@"</span><span class="pun">,</span><span class="pln">userInfo</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">        </span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"error:%@"</span><span class="pun">,</span><span class="pln">error</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pun">}];</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="22az" id="设置语言">设置语言</h3><p data-anchor-id="46pi">DroiOAuth SDK 目前支持中文和英文两种语言，开发者可以调用以下接口更改登录页面的语言：</p><ul data-anchor-id="tqt8">
<li>DroiOAuthLanguageZH：中文</li>
<li>DroiOAuthLanguageEN：英文</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="8te8"><ol class="linenums"><li class="L0"><code><span class="pun">[</span><span class="typ">DroiOAuth</span><span class="pln"> setLanguage</span><span class="pun">:</span><span class="typ">DroiOAuthLanguageEN</span><span class="pun">];</span><span class="com">//设置语言为英文</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="65kw" id="设置log开关">设置Log开关</h3><p data-anchor-id="26n8">开发者可以根据需求开关DroiOAuth SDK内部的Log，建议在发布版本的时候关闭Log功能，节省资源。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="d7ye"><ol class="linenums"><li class="L0"><code><span class="pun">[</span><span class="typ">DroiOAuth</span><span class="pln"> setLogEnabled</span><span class="pun">:</span><span class="pln">NO</span><span class="pun">];</span><span class="com">//关闭log</span></code></li></ol></pre></div>
</body>
</html>