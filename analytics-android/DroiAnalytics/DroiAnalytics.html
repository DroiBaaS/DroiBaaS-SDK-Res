<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>统计分析</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="d2ya" id="统计分析">统计分析</h1><div class="md-section-divider"></div><h2 data-anchor-id="b3xd" id="简介">简介</h2><div class="md-section-divider"></div><h3 data-anchor-id="eu9c" id="什么是卓易统计分析">什么是卓易统计分析</h3><p data-anchor-id="e45u">卓易统计(DroiAnalytics)是一项面向移动应用开发者的数据统计服务。开发者集成DroiAnalytics SDK之后，应用的使用数据会传输到卓易统计服务器。开发者通过卓易数据分析后台可以查看数据的分析结果。开发者可以通过数据分析结果全方位了解用户行为，调整优化应用，为用户提供更好的产品体验。  </p><div class="md-section-divider"></div><h3 data-anchor-id="zp1d" id="卓易统计分析的工作原理">卓易统计分析的工作原理</h3><p data-anchor-id="9h8o">卓易统计SDK，收集用户的信息、使用行为，为云端分析提供数据。主要收集的信息包括： <br>
*   多种UI样式供开发者选择 <br>
*   自动收集信息（设备信息，应用信息等） <br>
*   页面信息 <br>
*   自定义事件 <br>
*   崩溃错误信息 <br>
卓易统计分析工作流程如下图： <br>
<img src="http://baastest.droi.cn/Uploads/DocFile/5767a8b04ba5c.png" alt="" title=""> </p><div class="md-section-divider"></div><h2 data-anchor-id="w1wd" id="安装">安装</h2><div class="md-section-divider"></div><h3 data-anchor-id="dm3q" id="快速入门">快速入门</h3><p data-anchor-id="lxxw">由于卓易统计SDK基于卓易CoreSDK，所以请在安装卓易统计SDK之前仔细阅读<a href="http://baastest.droi.cn/Index/docStart.html" target="_blank">快速入门</a>，并确保已经完成快速入门的所有步骤。</p><div class="md-section-divider"></div><h3 data-anchor-id="3p08" id="eclipse-安装sdk">Eclipse 安装SDK</h3><ol data-anchor-id="9mo0">
<li><p>下载SDK压缩包，解压后将 <code>droianalyticssdk.jar</code> 包导入到工程的 <code>libs</code> 目录下；右键工程根目录，选择<code>Properties</code> -&gt; <code>Java Build Path</code> -&gt; <code>Libraries</code>，然后点击<code>Add External JARs...</code> 选择指向jar的路径，点击OK，即导入成功。<strong><em>（ADT17及以上不需要手动导入）</em></strong></p></li>
<li><p>需要在 AndroidManifest 中配置权限</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-xml"><span class="tag">&lt;uses-permission</span><span class="pln"> </span><span class="atn">android:name</span><span class="pun">=</span><span class="atv">"android.permission.GET_TASKS"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li></ol></pre></li>
</ol><div class="md-section-divider"></div><h3 data-anchor-id="scxt" id="android-studio-安装sdk">Android Studio 安装SDK</h3><p data-anchor-id="wr0u">Android Studio环境下只需要在Project的<code>build.gradle</code>中添加如下依赖：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="oq3f"><ol class="linenums"><li class="L0"><code class="language-groovy"><span class="pln">dependencies </span><span class="pun">{</span></code></li><li class="L1"><code class="language-groovy"><span class="pln">    </span><span class="com">/*其他依赖 */</span></code></li><li class="L2"><code class="language-groovy"><span class="pln">    compile </span><span class="str">'com.droi.sdk:analytics:+'</span></code></li><li class="L3"><code class="language-groovy"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="kr7x" id="使用">使用</h2><div class="md-section-divider"></div><h3 data-anchor-id="86t6" id="初始化">初始化</h3><p data-anchor-id="y5tp">在Application的<code>onCreate()</code>方法中初始化。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="askd"><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">initialize</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="05ee" id="用户使用统计">用户使用统计</h3><p data-anchor-id="cfyg">会话（Session）代表在某一段时间内，用户与应用之间的交互。记录会话可获取新增用户、活跃用户、启动次数、使用时长等基本数据。 <br>
一次完整的Session包括如下三种情况： <br>
1.从启动应用到关闭应用 <br>
2.从启动应用到应用退至后台，且在后台运行时间超过30s <br>
3.启动应用后设备熄屏，熄屏时间超过30s  </p><p data-anchor-id="8pps"><strong><em>方式一</em></strong> <br>
可以在<code>Application</code>的<code>onCreate()</code>中调用以下代码：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="h9p1"><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">enableActivityLifecycleCallbacks</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span></code></li></ol></pre><p data-anchor-id="wmo0"><strong><em>方式二</em></strong> <br>
在每个Activity中调用<code>DroiAnalytics.onResume()</code>和<code>DroiAnalytics.onPause()</code>方法对。  </p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="9f4w"><ol class="linenums"><li class="L0"><code class="language-java"><span class="lit">@Override</span></code></li><li class="L1"><code class="language-java"><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onResume</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onResume</span><span class="pun">();</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">onResume</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L4"><code class="language-java"><span class="pun">}</span></code></li><li class="L5"><code class="language-java"><span class="lit">@Override</span></code></li><li class="L6"><code class="language-java"><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onPause</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-java"><span class="pln">    </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onPause</span><span class="pun">();</span></code></li><li class="L8"><code class="language-java"><span class="pln">    </span><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">onPause</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L9"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="hpuc">也可以新建一个BaseActivity继承自Activity，在BaseActivity的<code>onResume()</code>和<code>onPause()</code>方法中分别调用<code>DroiAnalytics.onResume()</code>和<code>DroiAnalytics.onPause()</code>方法。  </p><div class="md-section-divider"></div><h3 data-anchor-id="rj99" id="fragment页面统计">Fragment页面统计</h3><p data-anchor-id="bopa">在需要统计的Fragment中调用<code>onFragmentStart()</code>和<code>onFragmentEnd()</code>。请保证不同页面之间相互独立，没有交叉。  </p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="2kx9"><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">String</span><span class="pln"> mPageName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"page1"</span><span class="pun">;</span></code></li><li class="L1"><code class="language-java"><span class="lit">@Override</span></code></li><li class="L2"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onResume</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onResume</span><span class="pun">();</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">onFragmentStart</span><span class="pun">(</span><span class="pln">getActivity</span><span class="pun">(),</span><span class="pln"> mPageName</span><span class="pun">);</span></code></li><li class="L5"><code class="language-java"><span class="pun">}</span></code></li><li class="L6"><code class="language-java"><span class="lit">@Override</span></code></li><li class="L7"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onPause</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="language-java"><span class="pln">    </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onPause</span><span class="pun">();</span></code></li><li class="L9"><code class="language-java"><span class="pln">    </span><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">onFragmentEnd</span><span class="pun">(</span><span class="pln">getActivity</span><span class="pun">(),</span><span class="pln"> mPageName</span><span class="pun">);</span></code></li><li class="L0"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="reqd" id="自定义事件">自定义事件</h3><ol data-anchor-id="wkxg">
<li><p>计数事件 <br>
在需要统计的事件中调用如下方法：  </p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">String</span><span class="pln"> eventId </span><span class="pun">=</span><span class="pln"> </span><span class="str">"login"</span><span class="pun">;</span></code></li><li class="L1"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">onEvent</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">,</span><span class="pln"> eventId</span><span class="pun">);</span></code></li></ol></pre>

<p>如果您需要添加附加信息，可以调用如下方法：  </p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">String</span><span class="pln"> eventId </span><span class="pun">=</span><span class="pln"> </span><span class="str">"share"</span><span class="pun">;</span></code></li><li class="L1"><code class="language-java"><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> kv</span><span class="pun">=</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;();</span></code></li><li class="L2"><code class="language-java"><span class="pln">kv</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"shareto"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"QQ"</span><span class="pun">);</span><span class="com">//表示分享到QQ</span></code></li><li class="L3"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">onEvent</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">,</span><span class="pln"> eventId</span><span class="pun">,</span><span class="pln"> kv</span><span class="pun">);</span></code></li></ol></pre></li>
<li><p>计算事件 <br>
在您需要对某个事件进行计算统计时，调用如下方法:  </p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> kv</span><span class="pun">=</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;();</span></code></li><li class="L1"><code class="language-java"><span class="pln">kv</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"itemName"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"apple"</span><span class="pun">);</span></code></li><li class="L2"><code class="language-java"><span class="pln">kv</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"count"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">);</span></code></li><li class="L3"><code class="language-java"><span class="kwd">int</span><span class="pln"> du </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span><span class="com">//表示购买总金额</span></code></li><li class="L4"><code class="language-java"><span class="typ">String</span><span class="pln"> eventId </span><span class="pun">=</span><span class="pln"> </span><span class="str">"buy"</span><span class="pun">;</span></code></li><li class="L5"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">onCalculateEvent</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">,</span><span class="pln"> eventId</span><span class="pun">,</span><span class="pln"> kv</span><span class="pun">,</span><span class="pln"> du</span><span class="pun">);</span></code></li></ol></pre></li>
</ol><p data-anchor-id="vqk8"><strong><em>注意：</em></strong> <br>
事件<code>id</code>以及<code>map</code>中的<code>key</code>和<code>value</code>可用英文、数字和下划线“_”，不要使用中文、特殊字符和英文句号“.”。事件<code>id</code>长度不能超过128个字节，<code>key</code>不能超过128个字节，<code>value</code>不能超过256个字节。</p><div class="md-section-divider"></div><h3 data-anchor-id="qu9w" id="错误统计">错误统计</h3><ol data-anchor-id="81up">
<li><p>崩溃信息 <br>
SDK通过<code>Thread.UncaughtExceptionHandler</code>捕获程序崩溃日志，并在程序下次启动时发送到服务器。该功能默认打开，如需关闭此功能，在Application的<code>onCreate</code>中调用如下方法：</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">setCrashReport</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span></code></li></ol></pre>

<p>如果您需要在崩溃日志上传时同时上传附加log信息，在Application的<code>onCreate</code>中调用如下方法：</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">setCrashReportWithLog</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></code></li></ol></pre>

<p><strong><em>注意：</em></strong> <br>
只有使用我们提供的Logger类记录的log，才能在崩溃时作为附加log信息上传，所以需要使用该类来替换Android的Log类。 <br>
另外在开发时，可以通过以下方法来设置在LogCat中显示通过<code>Logger</code>产生的log信息（默认为true），在正式上线时设置为false。</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">setDebugMode</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></code></li></ol></pre></li>
<li><p>自定义错误信息 <br>
您也可以发送自定义错误信息。</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-java"><span class="com">//发送一个错误String</span></code></li><li class="L1"><code class="language-java"><span class="typ">String</span><span class="pln"> errorInfo </span><span class="pun">=</span><span class="pln"> </span><span class="str">"this is an error"</span><span class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">onError</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">,</span><span class="pln"> errorInfo</span><span class="pun">);</span></code></li><li class="L3"><code class="language-java"><span class="com">//发送一个Exception</span></code></li><li class="L4"><code class="language-java"><span class="typ">Exception</span><span class="pln"> e </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Exception</span><span class="pun">(</span><span class="str">"exception"</span><span class="pun">);</span></code></li><li class="L5"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">onError</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">);</span></code></li></ol></pre>

<p><strong><em>注意：</em></strong> <br>
<code>errorInfo</code>可用英文、数字和下划线“_”，不要使用中文、特殊字符和英文句号“.”。<code>errorInfo</code>长度不能超过512个字节。</p></li>
</ol><div class="md-section-divider"></div><h3 data-anchor-id="9rnl" id="发送策略">发送策略</h3><p data-anchor-id="6m9t">实时发送：每当有一条新的记录，就会激发一次发送（不考虑网络环境），实际发送的间隔是3分钟。 <br>
非实时发送：开发者可以指定从半小时到1天之间的任意时间间隔上报数据记录，也可指定只在WIFI环境下才发送。 <br>
默认的发送策略是实时发送，也可以设置为非实时发送。在非实时策略略下，可以设置是否只在wifi下发送以及发送间隔<strong><em>（以分钟为单位）</em></strong>。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="5zdt"><ol class="linenums"><li class="L0"><code class="language-java"><span class="com">//设置为非实时</span></code></li><li class="L1"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">setDefaultReportPolicy</span><span class="pun">(</span><span class="typ">SendPolicy</span><span class="pun">.</span><span class="pln">SCHEDULE</span><span class="pun">);</span></code></li><li class="L2"><code class="language-java"><span class="com">//设置非实时策略下 是否只在wifi下发送及发送间隔</span></code></li><li class="L3"><code class="language-java"><span class="typ">DroiAnalytics</span><span class="pun">.</span><span class="pln">setScheduleReportPolicy</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">);</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="ld3m" id="测试模式">测试模式</h3><p data-anchor-id="xxog">如果开发者需要在logcat中看到SDK产生的log，需要在SD卡目录下的<code>droi</code>文件夹中（如果没有请创建）放入<code>dev_data.json</code>文件，文件中写入字符串 <code>{"debug_mode":true}</code>。</p></div>
</body>
</html>