<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>统计分析</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="y9pf" id="统计分析">统计分析</h1><div class="md-section-divider"></div><h2 data-anchor-id="b09e" id="简介">简介</h2><p data-anchor-id="ey6i">卓易统计(DroiAnalytics)是一项面向移动应用开发者的数据统计服务。开发者集成DroiAnalytics SDK之后，应用的使用数据会传输到DroiBaaS服务器。开发者通过DroiBaaS web后台可以查看数据的分析结果。开发者可以通过数据分析结果全方位了解用户行为，调整优化应用，为用户提供更好的产品体验。</p><div class="md-section-divider"></div><h2 data-anchor-id="fdc7" id="安装">安装</h2><div class="md-section-divider"></div><h3 data-anchor-id="00xe" id="开发环境">开发环境</h3><ul data-anchor-id="j3cd">
<li>操作系统：Mac OS X</li>
<li>开发工具：Xcode 6.x 及以上版本</li>
<li>iOS版本：需要iOS 8.0及以上系统</li>
</ul><div class="md-section-divider"></div><h3 data-anchor-id="bp5p" id="使用cocoapods方式集成推荐">使用CocoaPods方式集成（推荐）</h3><p data-anchor-id="dz7k">DroiAnalytics SDK使用CocoaPods作为函数库的管理工具。我们推荐您使用CocoaPods这种方式来安装SDK，这样可以大大简化安装DroiAnalytics SDK的流程。如果您未安装CocoaPods，请参考《CocoaPods安装和使用教程》完成安装。CocoaPods安装完成后，在您的项目根目录下创建一个Podfile文件，并添加如下内容：</p><pre data-anchor-id="xv2z"><code>pod  'DroiAnalytics'
</code></pre><p data-anchor-id="xf16">在控制台中cd到Podfile文件所在目录，执行如下命令完成安装。</p><pre data-anchor-id="vtz7"><code>pod  install
</code></pre><div class="md-section-divider"></div><h3 data-anchor-id="5fen" id="手动安装">手动安装</h3><div class="md-section-divider"></div><h4 data-anchor-id="wt76" id="1-安装droicoresdk">1. 安装DroiCoreSDK</h4><p data-anchor-id="dj3y">由于DroiAnalytics SDK依赖于DroiCore SDK，所以请在安装DroiAnalytics SDK之前仔细阅读<a href="http://baastest.droi.cn/Index/docStart.html" target="_blank">快速入门</a> ，完成DroiCore SDK的安装。</p><div class="md-section-divider"></div><h4 data-anchor-id="8810" id="2-导入sdk到应用程序项目">2. 导入SDK到应用程序项目</h4><p data-anchor-id="napz">将SDK包解压，在XCode中选择”Add files to 'Your project name’…”，将解压后的DroiAnalyticsLib文件夹中的<code>DroiAnalytics.framework</code>添加到你的工程目录中。</p><div class="md-section-divider"></div><h4 data-anchor-id="4jdb" id="3-添加必要的框架">3. 添加必要的框架</h4><p data-anchor-id="2nw4">点击<code>Build Phases</code>选项，在<code>Link Binary With Libraries</code>中添加以下内容： <br>
- Foundation.framework <br>
- UIKit.framework <br>
- CoreLocation.framework <br>
- CoreTelephony.framework</p><div class="md-section-divider"></div><h2 data-anchor-id="7qpq" id="使用">使用</h2><div class="md-section-divider"></div><h3 data-anchor-id="ba07" id="初始化sdk">初始化SDK</h3><p data-anchor-id="2piq">在AppDelegate.m中初始化DroiAnalytics SDK:</p><pre data-anchor-id="yfc1"><code>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOption{

    [DroiAnalytics startAnalytics];
    return YES;
}
</code></pre><div class="md-section-divider"></div><h3 data-anchor-id="ziqr" id="数据上报策略">数据上报策略</h3><p data-anchor-id="wdsu">DroiAnalytics SDK 为开发者提供了两种数据上报策略：</p><ul data-anchor-id="j90a">
<li><p>即时上报：每当有一条新的统计数据产生，就会激发一次上报（不考虑网络环境）。如果应用程序此时处在不联网状态，那么消息将会缓存在本地，下次再尝试发送。</p></li>
<li><p>非即时上报：开发者可以指定从半小时到一天的任意时间间隔上报数据记录，也可指定只在WIFI环境下才上报。如果上报数据时应用处在非指定的网络环境下（无网或非WIFI网络），那么消息将会缓存在本地，下次再尝试发送。</p></li>
</ul><p data-anchor-id="l3qq">DroiAnalytics SDK默认为即时上报(实际发生间隔约为3min)，可以通过SDK预留的接口修改发送策略。</p><pre data-anchor-id="yal9"><code>//设置为只在WIFI网络下，半小时的时间间隔上报数据
[DroiAnalytics setScheduleConfigTime:30 onlyInWifi:YES];
</code></pre><p data-anchor-id="wqmr"><strong>注意：如果需要修改发生策略，请在初始化SDK之后立即调用才能正确设置</strong></p><div class="md-section-divider"></div><h3 data-anchor-id="fhah" id="页面统计功能">页面统计功能</h3><p data-anchor-id="1k60">DroiAnalytics SDK 提供了页面统计的功能，开发者可以在需要统计的页面中调用配对方法才能准确的统计页面使用情况。页面统计集成正确，才能够获取正确的页面访问路径、访问深度（PV）的数据。在需要统计页面访问情况的页面中配对调用如下方法：</p><pre data-anchor-id="s8sm"><code>- (void)viewDidAppear:(BOOL)animated{
    [super viewDidAppear:animated];
    [DroiAnalytics beginLogPageView:@“pageName”];
}

- (void)viewDidDisappear:(BOOL)animated{
    [super viewDidDisappear:animated];
    [DroiAnalytics endLogPageView:@"pageName"];
}
</code></pre><p data-anchor-id="e603"><strong>注意：pageName为页面名称，可自定义，但在同一个view下应保持一致，否则无法准确统计页面访问记录。</strong></p><div class="md-section-divider"></div><h3 data-anchor-id="tgid" id="自定义事件统计">自定义事件统计</h3><p data-anchor-id="n6c3">DroiAnalytics SDK提供了自定义事件统计功能。开发者可结合应用的业务逻辑，添加自定义参数的统计。</p><div class="md-section-divider"></div><h4 data-anchor-id="83un" id="1-计数事件">1. 计数事件</h4><p data-anchor-id="jiyj">计数类型事件通常用来描述一个事件累计发生的次数。适用场景如按钮点击、界面进入、用户输入等。统计后台会对这类时间做总发生次数、总覆盖用户数等统计计算。 <br>
例如，统计视频应用中某个视频的收藏次数，可以在收藏的方法中调用：</p><pre data-anchor-id="br6l"><code>//attributes为附带参数，可自定义也可为nil
NSDictionary *att = @{@"name":@"Jackass",@"type":@"funny"};
[DroiAnalytics event:@"collect" attributes:att];
</code></pre><div class="md-section-divider"></div><h4 data-anchor-id="lter" id="2-计算事件">2. 计算事件</h4><p data-anchor-id="xm6u">计算类型事件通常描述一个带数值的事件的发生,适用的场景如用户消费事件，附带的数值是每次消费的金额;下载文件事件,附带的数值是每次下载消耗的时长等。统计后台会对这类事件做累加、分布、按次平均、按人平均等统计计算。 <br>
例如，某电商应用书籍类消费金额统计：</p><pre data-anchor-id="9l7e"><code>//attributes为附带参数，可自定义也可为nil
NSDictionary *att = @{@"name":@"A Brief History Of Time",@"type":@"book"};
//num 代表此次事件的数值
[DroiAnalytics event:@"buy" attributes:att num:99 ];
</code></pre><div class="md-section-divider"></div><h3 data-anchor-id="pffg" id="错误统计">错误统计</h3><p data-anchor-id="z3f4">DroiAnalytics SDK会收集应用的崩溃信息，并且在下次应用打开时上传至服务器。此功能默认为开启状态，不需要开发者手动调用。如果开发者自己实现了错误信息统计，可以调用以下方法关闭错误统计功能：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="b168"><ol class="linenums"><li class="L0"><code><span class="pun">[</span><span class="typ">DroiAnalytics</span><span class="pln"> setCrashReportEnabled</span><span class="pun">:</span><span class="pln">NO</span><span class="pun">];</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="zxpd" id="地理位置统计">地理位置统计</h3><p data-anchor-id="j64q">DroiAnalytics SDK提供给开发者用于统计app用户地理位置信息的功能，开发者需要调用以下接口上传地理位置信息。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="beuk"><ol class="linenums"><li class="L0"><code><span class="com">//latitude 为纬度 longitude 为经度</span></code></li><li class="L1"><code><span class="pun">[</span><span class="typ">DroiAnalytics</span><span class="pln"> setLatitude</span><span class="pun">:</span><span class="lit">88.0</span><span class="pln"> longitude</span><span class="pun">:</span><span class="lit">88.0</span><span class="pun">];</span></code></li></ol></pre><p data-anchor-id="o3rn">也可调用如下接口，直接上传地理位置的CLLocation对象</p><pre data-anchor-id="eite"><code>+ (void)setLocation:(CLLocation *)location;
</code></pre><p data-anchor-id="gae4">app用户的地理位置信息需要开发者自己调用苹果的地理位置信息API获取，以下为一段示例代码：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="gxu2"><ol class="linenums"><li class="L0"><code><span class="com">#import "ViewController.h"</span></code></li><li class="L1"><code><span class="com">#import &lt;DroiAnalytics.h&gt;</span></code></li><li class="L2"><code><span class="com">#import &lt;CoreLocation/CoreLocation.h&gt;</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="lit">@interface</span><span class="pln"> </span><span class="typ">ViewController</span><span class="pln"> </span><span class="pun">()&lt;</span><span class="typ">CLLocationManagerDelegate</span><span class="pun">&gt;</span></code></li><li class="L5"><code><span class="lit">@property</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nonatomic </span><span class="pun">,</span><span class="pln">strong</span><span class="pun">)</span><span class="pln"> </span><span class="typ">CLLocationManager</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> locationManager</span><span class="pun">;</span></code></li><li class="L6"><code><span class="lit">@end</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="lit">@implementation</span><span class="pln"> </span><span class="typ">ViewController</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln">viewDidLoad </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">[</span><span class="kwd">super</span><span class="pln"> viewDidLoad</span><span class="pun">];</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="com">// 判断定位操作是否被允许</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">locationManager </span><span class="pun">=[[</span><span class="typ">CLLocationManager</span><span class="pln"> alloc</span><span class="pun">]</span><span class="pln">init</span><span class="pun">];</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(![</span><span class="typ">CLLocationManager</span><span class="pln"> locationServicesEnabled</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">        </span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"定位服务当前可能尚未打开，请设置打开！"</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pln">    </span><span class="com">//如果没有授权则请求用户授权</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">([[[</span><span class="typ">UIDevice</span><span class="pln"> currentDevice</span><span class="pun">]</span><span class="pln"> systemVersion</span><span class="pun">]</span><span class="pln"> floatValue</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">8.0</span><span class="pun">)</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">([</span><span class="typ">CLLocationManager</span><span class="pln"> authorizationStatus</span><span class="pun">]==</span><span class="pln">kCLAuthorizationStatusNotDetermined</span><span class="pun">){</span></code></li><li class="L3"><code><span class="pln">            </span><span class="pun">[</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">locationManager requestWhenInUseAuthorization</span><span class="pun">];</span></code></li><li class="L4"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code><span class="pln">    </span><span class="com">//设置代理</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">locationManager</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pun">=</span><span class="kwd">self</span><span class="pun">;</span></code></li><li class="L8"><code><span class="pln">    </span><span class="com">//设置定位精度</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">locationManager</span><span class="pun">.</span><span class="pln">desiredAccuracy</span><span class="pun">=</span><span class="pln">kCLLocationAccuracyNearestTenMeters</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="com">//定位频率,每隔多少米定位一次</span></code></li><li class="L1"><code><span class="pln">    </span><span class="typ">CLLocationDistance</span><span class="pln"> distance </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10.0</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">locationManager</span><span class="pun">.</span><span class="pln">distanceFilter</span><span class="pun">=</span><span class="pln">distance</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//启动跟踪定位</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">[</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">locationManager startUpdatingLocation</span><span class="pun">];</span></code></li><li class="L5"><code><span class="pun">}</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="com">#pragma</span><span class="pln"> mark </span><span class="pun">-</span><span class="pln"> </span><span class="typ">CoreLocation</span><span class="pln"> </span><span class="typ">Delegate</span></code></li><li class="L8"><code><span class="pun">-(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln">locationManager</span><span class="pun">:(</span><span class="typ">CLLocationManager</span><span class="pln"> </span><span class="pun">*)</span><span class="pln">manager didUpdateLocations</span><span class="pun">:(</span><span class="typ">NSArray</span><span class="pln"> </span><span class="pun">*)</span><span class="pln">locations</span></code></li><li class="L9"><code><span class="pun">{</span></code></li><li class="L0"><code><span class="pln">    </span><span class="com">//此处locations存储了持续更新的位置坐标值，取最后一个值为最新位置，如果不想让其持续更新位置，则在此方法中获取到一个值之后让locationManager stopUpdatingLocation</span></code></li><li class="L1"><code><span class="pln">    </span><span class="typ">CLLocation</span><span class="pln"> </span><span class="pun">*</span><span class="pln">currentLocation </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">locations lastObject</span><span class="pun">];</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//通过DroiAnalysis SDK上报地理位置信息</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">[</span><span class="typ">DroiAnalytics</span><span class="pln"> setLocation</span><span class="pun">:</span><span class="pln">currentLocation</span><span class="pun">];</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="com">//系统会一直更新数据，直到选择停止更新，因为我们只需要获得一次经纬度即可，所以获取之后就停止更新</span></code></li><li class="L7"><code><span class="pln">    </span><span class="pun">[</span><span class="pln">manager stopUpdatingLocation</span><span class="pun">];</span></code></li><li class="L8"><code><span class="pun">}</span></code></li><li class="L9"><code></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln">locationManager</span><span class="pun">:(</span><span class="typ">CLLocationManager</span><span class="pln"> </span><span class="pun">*)</span><span class="pln">manager</span></code></li><li class="L2"><code><span class="pln">       didFailWithError</span><span class="pun">:(</span><span class="typ">NSError</span><span class="pln"> </span><span class="pun">*)</span><span class="pln">error </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">        </span><span class="com">//获取地理位置错误处理</span></code></li><li class="L4"><code><span class="pln">        </span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"An error occurred = %@"</span><span class="pun">,</span><span class="pln"> error</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="2mzb" id="log开关功能">Log开关功能</h3><p data-anchor-id="belb">DroiAnalytics SDK 默认开启Log功能，如果开发者需要关闭Log可以手动调用以下方法关闭Log：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="lsxc"><ol class="linenums"><li class="L0"><code><span class="pun">[</span><span class="typ">DroiAnalytics</span><span class="pln"> setLogEnabled</span><span class="pun">:</span><span class="pln">NO</span><span class="pun">];</span></code></li></ol></pre></div>
</body>
</html>